<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      body {
        background: var(--gray-100);
        min-height: 100vh;
        display: flex;
        align-items: flex-start;
        justify-content: center;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }
      .stepper-container {
        background: var(--white);
        border-radius: 18px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.10);
        padding: 40px 32px 32px 32px;
        max-width: 650px;
        margin: 48px auto 24px auto;
        width: 100%;
      }
      .switch-top-bar {
        display: flex;
        justify-content: flex-end;
        align-items: center;
        width: 100%;
        margin-bottom: 8px;
      }
      .licitacao-switch-container {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-bottom: 24px;
      }
      .switch-label {
        font-weight: 600;
        color: var(--primary);
      }
      .switch-tooltip {
        font-size: 12px;
        color: var(--gray-500);
      }
      #stepper-title {
        font-size: 1.35rem;
        font-weight: bold;
        color: var(--primary);
        margin-bottom: 32px;
        margin-top: 0;
        text-align: left;
      }
      .br-accordion {
        width: 100%;
        max-width: 520px;
        margin: 0 auto 24px auto;
        border-radius: 12px;
        background: var(--gray-50);
        border: 1px solid var(--gray-200);
        box-shadow: 0 4px 24px rgba(0,0,0,0.10);
      }
      .br-accordion .item {
        border-bottom: 1px solid var(--gray-200);
        display: flex;
        flex-direction: column;
      }
      .br-accordion .item[active] {
        background: #003366;
        color: #fff;
      }
      .br-accordion .header {
        background: transparent;
        border: 0;
        color: #003366;
        display: flex;
        align-items: center;
        width: 100%;
        font-size: 1.13rem;
        font-weight: 600;
        justify-content: space-between;
        outline: none;
        padding: 20px 32px;
        cursor: pointer;
        transition: background 0.2s, color 0.2s;
      }
      .br-accordion .item[active] .header {
        background: #003366;
        color: #fff;
      }
      .br-accordion .header:focus-visible {
        outline: 2px solid #ffcc00;
        outline-offset: 2px;
        background: #00509e;
        color: #fff;
      }
      .br-accordion .header .icon {
        margin-right: 32px;
        font-size: 1.25em;
        display: flex;
        align-items: center;
        color: #ffcc00;
        color: #ffcc00;
      }
      .br-accordion .header .title {
        flex: 1;
        text-align: left;
      }
      .br-accordion .content {
        background: var(--white);
        color: var(--gray-700);
        font-size: 1.08rem;
        padding: 24px 36px 24px 36px;
        border-radius: 0 0 12px 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        margin: 0 0 12px 0;
        display: block;
        animation: fadeIn 0.3s;
      }
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      .stepper-layout {
        display: flex;
        flex-direction: row;
        gap: 0;
        min-height: 320px;
        align-items: flex-start;
        width: 100%;
      }
      .sidebar-menu {
        min-width: 200px;
        width: 220px;
        height: 100%;
        background: var(--gray-50);
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        padding: 24px 0 24px 0;
        margin-right: 24px;
        flex-shrink: 0;
      }
      .step-content {
        background: var(--white);
        border-radius: 12px;
        padding: 32px 24px 24px 24px;
        color: var(--gray-700);
        min-height: 80px;
        font-size: 1.08rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.02);
        border: 1px solid var(--gray-200);
        flex: 1 1 0%;
        margin: 0;
        max-width: 480px;
        align-self: stretch;
      }
      /* Removido: definição duplicada de .sidebar-step.active com fundo branco */
      .stepper::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 32px;
        right: 32px;
        height: 4px;
        background: var(--gray-200);
        z-index: 0;
        border-radius: 2px;
      }
      .step {
        position: relative;
        z-index: 1;
        display: flex;
        flex-direction: row;
        align-items: center;
        min-width: 120px;
        gap: 8px;
        justify-content: center;
        white-space: nowrap;
        flex-shrink: 0;
      }
      .step-icon {
        width: 38px;
        height: 38px;
        border-radius: 50%;
        background: var(--gray-200);
        color: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.3rem;
        font-weight: bold;
        border: 3px solid var(--gray-200);
        transition: background 0.3s, color 0.3s, border 0.3s;
        margin-bottom: 0;
        margin-right: 0;
      }
      .step.active .step-icon {
        background: var(--accent);
        color: var(--primary);
        border: 3px solid var(--accent);
      }
      .step.completed .step-icon {
        background: var(--primary);
        color: var(--white);
        border: 3px solid var(--primary);
      }
      .step-label {
        font-size: 0.98rem;
        color: var(--gray-700);
        text-align: left;
        font-weight: 500;
        margin: 0 0 0 4px;
        white-space: nowrap;
      }
      .step-content {
        background: var(--white);
        border-radius: 0 0 12px 12px;
        padding: 32px 20px 24px 20px;
        margin-bottom: 0;
        color: var(--gray-700);
        min-height: 80px;
        font-size: 1.08rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.02);
        border-top: 1px solid var(--gray-200);
      }
      .stepper-actions {
        display: flex;
        justify-content: flex-end;
        gap: 16px;
        margin-top: 8px;
      }
      .btn {
        padding: 12px 28px;
        border-radius: 8px;
        border: none;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: background 0.2s, color 0.2s;
        box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      }
      .btn-primary {
        background: var(--accent);
        color: var(--primary);
      }
      .btn-primary:hover {
        background: var(--accent-hover);
      }
      .btn-secondary {
        background: var(--gray-200);
        color: var(--primary);
      }
      .btn-secondary:disabled {
        background: var(--gray-100);
        color: var(--gray-400);
        cursor: not-allowed;
      }
      @media (max-width: 800px) {
        .stepper-container {
          padding: 16px 2px;
          max-width: 99vw;
        }
        .stepper-layout {
          flex-direction: column;
        }
        .sidebar-menu {
          margin-right: 0;
          margin-bottom: 16px;
        }
      }
    </style>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caixa - Processo de Contratação</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
    <!-- Header -->
    <header class="header">
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-logo">
                    <img src="../assets/images/logo-caixa.svg" alt="Caixa" class="logo">
                </div>
                <div class="nav-text">
                    <h1 class="system-title">SILIC 2.0</h1>
                    <p class="system-subtitle">Protótipo - Solicitações de Serviços</p>
                </div>
                <div class="nav-actions">
                    <button id="voltarPortalBtn" class="btn-voltar-portal" onclick="window.close()">
                        <i class="fas fa-arrow-left"></i>
                        Voltar ao Portal
                    </button>
                </div>
            </div>
        </nav>
    </header>
    <main class="cloud-main">
      <div class="search-form" style="margin-top:32px;">
        <div class="search-fields" style="flex-direction:column;gap:0;">
          <div class="switch-top-bar">
            <label class="switch-label" for="licitacaoSwitch" style="margin-bottom:0;font-weight:600;color:var(--primary);margin-right:8px;">Houve processo licitatório?</label>
            <label class="switch" title="Ative para informar se houve licitação" style="display:inline-flex;align-items:center;cursor:pointer;">
              <input type="checkbox" id="licitacaoSwitch" disabled style="display:none;">
              <span class="custom-switch" tabindex="0" role="switch" aria-checked="false" id="customSwitch" style="width:44px;height:24px;display:inline-block;background:#e0e0e0;border-radius:12px;position:relative;transition:background 0.2s;vertical-align:middle;outline:none;">
                <span style="position:absolute;left:2px;top:2px;width:20px;height:20px;background:#fff;border-radius:50%;box-shadow:0 1px 4px rgba(0,0,0,0.08);transition:left 0.2s;"></span>
              </span>
            </label>
            <span class="switch-tooltip" id="switchTooltip" style="font-size:12px;color:var(--gray-500);margin-left:8px;">Ative manualmente para informar</span>
          </div>
          <!-- Título no topo -->
          <h2 id="stepper-title" style="font-size:1.5rem;font-weight:bold;color:var(--primary);margin:0 0 24px 0;text-align:left;">Locação - Nova Unidade (Pessoa Jurídica)</h2>
          <div class="stepper-layout">
            <div class="accordion-menu" id="accordionMenu"></div>
          </div>
        </div>
      </div>
    </main>
    <script>
        // Função para obter parâmetros da query string
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        // Parâmetros vindos da tela anterior
        const tipoContratacao = getQueryParam('tipoContratacao') || 'Nova unidade';
        const tipoPessoa = getQueryParam('tipoPessoa') || 'Pessoa Jurídica';

        // Atualiza o título dinamicamente
        document.addEventListener('DOMContentLoaded', function() {
            const title = document.getElementById('stepper-title');
            if (title) {
                title.textContent = `Locação - ${tipoContratacao.charAt(0).toUpperCase() + tipoContratacao.slice(1).replace('-', ' ')} (${tipoPessoa.charAt(0).toUpperCase() + tipoPessoa.slice(1)})`;
            }
        });

        // Etapas possíveis
        const stepsWithLicitacao = [
            { label: 'Processo licitatório', content: 'Detalhes sobre o processo licitatório.' },
            { label: 'Documentação', content: 'Envio e análise de documentos necessários.' },
            { label: 'Compliance', content: 'Verificação de conformidade e integridade.' },
            { label: 'Análise jurídica e riscos', content: 'Avaliação jurídica e de riscos.' },
            { label: 'Financeiro', content: 'Análise financeira e aprovação.' }
        ];
        const stepsWithoutLicitacao = [
            { label: 'Documentação', content: 'Envio e análise de documentos necessários.' },
            { label: 'Compliance', content: 'Verificação de conformidade e integridade.' },
            { label: 'Análise jurídica e riscos', content: 'Avaliação jurídica e de riscos.' },
            { label: 'Financeiro', content: 'Análise financeira e aprovação.' }
        ];
        let licitacaoAtiva = false;
        let currentStep = null;
        let steps = stepsWithoutLicitacao;


        // Switch customizado acessível
        function setupSwitch() {
            const licitacaoSwitch = document.getElementById('licitacaoSwitch');
            const customSwitch = document.getElementById('customSwitch');
            if (!licitacaoSwitch || !customSwitch) return;
            licitacaoSwitch.disabled = false;
            customSwitch.style.background = '#e0e0e0';
            document.getElementById('switchTooltip').textContent = 'Selecione se houve licitação';

            function setSwitchState(checked) {
                licitacaoSwitch.checked = checked;
                customSwitch.setAttribute('aria-checked', checked ? 'true' : 'false');
                customSwitch.style.background = checked ? '#0096d6' : '#e0e0e0';
                customSwitch.querySelector('span').style.left = checked ? '22px' : '2px';
            }

            customSwitch.onclick = function() {
                if (licitacaoSwitch.disabled) return;
                setSwitchState(!licitacaoSwitch.checked);
                licitacaoAtiva = licitacaoSwitch.checked;
                steps = licitacaoAtiva ? stepsWithLicitacao : stepsWithoutLicitacao;
                currentStep = 0;
                renderAccordionMenu();
            };
            customSwitch.onkeydown = function(e) {
                if (licitacaoSwitch.disabled) return;
                if (e.key === ' ' || e.key === 'Enter') {
                    e.preventDefault();
                    setSwitchState(!licitacaoSwitch.checked);
                    licitacaoAtiva = licitacaoSwitch.checked;
                    steps = licitacaoAtiva ? stepsWithLicitacao : stepsWithoutLicitacao;
                    currentStep = 0;
                    renderAccordionMenu();
                }
            };
            setSwitchState(false);
        }

        // Ícones para cada etapa (Azure/Google Cloud style)
        const stepIcons = [
            '<i class="fas fa-gavel"></i>', // Processo licitatório
            '<i class="fas fa-file-alt"></i>', // Documentação
            '<i class="fas fa-shield-alt"></i>', // Compliance
            '<i class="fas fa-balance-scale"></i>', // Análise jurídica
            '<i class="fas fa-coins"></i>' // Financeiro
        ];
        function renderAccordionMenu() {
            const menu = document.getElementById('accordionMenu');
            menu.className = 'br-accordion';
            menu.innerHTML = '';
            steps.forEach((step, idx) => {
                const item = document.createElement('div');
                item.className = 'item';
                if (idx === currentStep) item.setAttribute('active', '');
                // Header como button acessível
                const header = document.createElement('button');
                header.type = 'button';
                header.className = 'header';
                header.setAttribute('aria-expanded', idx === currentStep ? 'true' : 'false');
                header.setAttribute('aria-controls', `accordion-content-${idx}`);
                header.onclick = function() {
                    const wasActive = item.hasAttribute('active');
                    // Fecha todos
                    const allItems = menu.querySelectorAll('.item');
                    allItems.forEach(it => it.removeAttribute('active'));
                    // Se não estava aberto, abre
                    if (!wasActive) {
                        item.setAttribute('active', '');
                        currentStep = idx;
                    } else {
                        currentStep = null;
                    }
                    renderAccordionMenu();
                };
                // Ícone gov.br
                const icon = document.createElement('span');
                icon.className = 'icon';
                icon.innerHTML = idx === currentStep
                  ? '<i class="fas fa-angle-up"></i>'
                  : '<i class="fas fa-angle-down"></i>';
                // Título
                const title = document.createElement('span');
                title.className = 'title';
                title.textContent = step.label;
                header.appendChild(icon);
                header.appendChild(title);
                item.appendChild(header);
                // Content (apenas se aberto)
                if (idx === currentStep) {
                    const content = document.createElement('div');
                    content.className = 'content';
                    content.id = `accordion-content-${idx}`;
                    content.innerHTML = renderStepContentHTML();
                    item.appendChild(content);
                }
                menu.appendChild(item);
            });
        }

        // Wizard sequencial só dentro da etapa selecionada
        function renderStepContentHTML() {
            let html = '';
            // Exemplo: wizard interno para Documentação
            if (steps[currentStep].label === 'Documentação') {
                if (!window.docWizardStep) window.docWizardStep = 0;
                const docSteps = [
                  `<div><strong>Envie os documentos necessários:</strong><br><input type="file" id="docUpload" name="docUpload" multiple style="margin-top:8px;"></div>`,
                  `<div><label for="docObs">Observações:</label><br><textarea id="docObs" name="docObs" rows="3" style="width:100%;margin-top:6px;"></textarea></div>`,
                  `<div><strong>Confirmação:</strong><br>Documentos enviados com sucesso!</div>`
                ];
                html = `<form id="docForm">
                  <div style="margin-bottom:18px;">${docSteps[window.docWizardStep]}</div>
                  <div style="display:flex;gap:12px;justify-content:flex-end;">
                    <button type="button" class="btn btn-secondary" id="docPrev" ${window.docWizardStep === 0 ? 'disabled' : ''}>Anterior</button>
                    <button type="button" class="btn btn-primary" id="docNext">${window.docWizardStep === docSteps.length-1 ? 'Finalizar' : 'Próximo'}</button>
                  </div>
                </form>`;
            } else {
                html = `<div style="font-size:1.08rem;"><span>${steps[currentStep].content}</span></div>`;
            }
            return html;
        }

        function prevStep() {
            if (currentStep > 0) {
                currentStep--;
                renderStepper();
                renderStepContent();
            }
        }
        function nextStep() {
            if (currentStep < steps.length - 1) {
                currentStep++;
                renderStepper();
                renderStepContent();
            } else {
                alert('Fluxo concluído!');
            }
        }

        // Inicialização
        setupSwitch();
        renderAccordionMenu();
        // Delegar eventos dos botões do wizard após renderização
        document.addEventListener('click', function(e) {
            if (e.target && e.target.id === 'docPrev') {
                window.docWizardStep = Math.max(0, window.docWizardStep-1);
                renderAccordionMenu();
            }
            if (e.target && e.target.id === 'docNext') {
                if (!window.docWizardStep) window.docWizardStep = 0;
                if (window.docWizardStep < 2) {
                    window.docWizardStep++;
                    renderAccordionMenu();
                } else {
                    alert('Documentos enviados!');
                    window.docWizardStep = 0;
                    renderAccordionMenu();
                }
            }
        });
    </script>
      body {
        background: var(--gray-100);
        min-height: 100vh;
        margin: 0;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }
      .cloud-header {
        background: var(--white);
        border-bottom: 1px solid var(--gray-200);
        height: 56px;
        display: flex;
        align-items: center;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 100;
        box-shadow: 0 2px 8px rgba(0,0,0,0.03);
      }
      .cloud-header-content {
        display: flex;
        align-items: center;
        gap: 16px;
        height: 100%;
        margin-left: 32px;
      }
      .cloud-logo {
        height: 32px;
        width: auto;
      }
      .cloud-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--primary);
        letter-spacing: 0.5px;
      }
      .cloud-breadcrumb {
        background: var(--gray-100);
        border-bottom: 1px solid var(--gray-200);
        height: 40px;
        display: flex;
        align-items: center;
        padding-left: 48px;
        font-size: 1rem;
        color: var(--gray-600);
        margin-top: 56px;
        font-weight: 500;
      }
      .cloud-main {
        display: flex;
        justify-content: center;
        align-items: flex-start;
        min-height: calc(100vh - 96px);
        padding-top: 32px;
      }
      .stepper-container {
        background: var(--white);
        border-radius: 18px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.10);
        padding: 40px 32px 32px 32px;
        max-width: 650px;
        margin: 0 auto 24px auto;
        width: 100%;
      }
      @media (max-width: 900px) {
        .stepper-container {
          padding: 24px 8px 24px 8px;
          max-width: 98vw;
        }
      }
      @media (max-width: 600px) {
        .stepper-container {
          padding: 10px 2vw 10px 2vw;
          border-radius: 0;
        }
        /* Stepper sempre horizontal */
        .stepper {
          flex-direction: row !important;
          gap: 16px;
        }
        .step-content {
          padding: 12px 4px;
        }
        .btn {
          width: 100%;
          padding: 12px 0;
        }
      }
                                <input type="text" id="tech-totalValue" class="doc-form-input" placeholder="Ex: 150000,00">
                            </div>
                        </div>
                        <div class="doc-form-grid">
                            <div class="doc-form-group">
                                <label class="doc-form-label">Valor da Obra - CAIXA (R$)</label>
                                <input type="text" id="tech-caixaValue" class="doc-form-input" placeholder="Ex: 90000,00">
                            </div>
                            <div class="doc-form-group">
                                <label class="doc-form-label">Valor da Obra - LOCADOR (R$)</label>
                                <input type="text" id="tech-tenantValue" class="doc-form-input" placeholder="Ex: 60000,00">
                            </div>
                        </div>
                        <div class="doc-form-grid">
                            <div class="doc-form-group">
                                <label class="doc-form-label">Prazo Total da Obra (meses)</label>
                                <input type="text" id="tech-totalDuration" class="doc-form-input" placeholder="Ex: 18">
                            </div>
                            <div class="doc-form-group">
                                <label class="doc-form-label">Prazo CAIXA (meses)</label>
                                <input type="text" id="tech-caixaDuration" class="doc-form-input" placeholder="Ex: 12">
                            </div>
                        </div>
                        <div class="doc-form-grid">
                            <div class="doc-form-group">
                                <label class="doc-form-label">Prazo LOCADOR (meses)</label>
                                <input type="text" id="tech-tenantDuration" class="doc-form-input" placeholder="Ex: 6">
                            </div>
                            <div class="doc-form-group">
                                <!-- Empty for grid alignment -->
                            </div>
                        </div>
                        <div class="doc-modal-footer" style="background: transparent; border: none; padding: 1rem 0; justify-content: flex-start;">
                            <button class="doc-btn doc-btn-secondary" onclick="clearDocumentation()">
                                <i class="fas fa-eraser"></i> Limpar
                            </button>
                            <button class="doc-btn doc-btn-warning" onclick="saveReport()">
                                <i class="fas fa-save"></i> Salvar Relatório
                            </button>
                            <button class="doc-btn doc-btn-success" onclick="validateData()">
                                <i class="fas fa-check"></i> Validar Dados
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Tenants Section -->
                <div class="doc-section">
                    <h3 class="doc-section-title">
                        <i class="fas fa-users"></i>
                        Documentos dos Locadores
                    </h3>
                    <div class="doc-people-section">
                        <div id="tenants-section">
                            <!-- Content populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Summary Section -->
                <div class="doc-section">
                    <h3 class="doc-section-title">
                        <i class="fas fa-chart-bar"></i>
                        Resumo Geral de Documentos
                    </h3>
                    <div class="doc-summary">
                        <div class="doc-summary-item entregues">
                            <div class="doc-summary-number">6</div>
                            <div class="doc-summary-label">Entregues</div>
                        </div>
                        <div class="doc-summary-item pendentes">
                            <div class="doc-summary-number">1</div>
                            <div class="doc-summary-label">Pendentes</div>
                        </div>
                        <div class="doc-summary-item analise">
                            <div class="doc-summary-number">1</div>
                            <div class="doc-summary-label">Em Análise</div>
                        </div>
                        <div class="doc-summary-item rejeitados">
                            <div class="doc-summary-number">0</div>
                            <div class="doc-summary-label">Rejeitados</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="doc-modal-footer">
                <button class="doc-btn doc-btn-secondary" onclick="closeDocumentationModal()">
                    <i class="fas fa-times"></i> Fechar
                </button>
                <button class="doc-btn doc-btn-primary" onclick="generateReport()">
                    <i class="fas fa-file-pdf"></i> Gerar Relatório
                </button>
                <button class="doc-btn doc-btn-success" onclick="updateStatus()">
                    <i class="fas fa-sync"></i> Atualizar Status
                </button>
            </div>
        </div>
    </div>

    <script src="stepper.js"></script>
    <script src="validation.js"></script>
    <script src="documentation.js"></script>
</body>
</html>
