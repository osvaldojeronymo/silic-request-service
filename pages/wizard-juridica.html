<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wizard Principal - Pessoa Jurídica</title>
  <link rel="stylesheet" href="../assets/css/style.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
  <div class="wizard-container">
    <div class="wizard-steps" id="wizardSteps"></div>
    <div class="wizard-content" id="wizardContent"></div>
  </div>
  
  <script src="../assets/js/main.js"></script>
  <script>
    const steps = [
      { label: 'Licitação', icon: '<i class="fas fa-gavel"></i>', content: `
        <form id="licitForm" style="display:flex;flex-direction:column;gap:18px;">
          <div>
          <div>
            <label for="parteRelacionadaDoc" style="font-weight:600;">Existe Parte Relacionada?</label><br>
            <select id="parteRelacionadaDoc" name="parteRelacionadaDoc" style="width:100%;padding:8px 10px;border-radius:8px;border:1.5px solid #e7e7e7;font-size:1rem;">
              <option value="">Selecione</option>
              <option value="Sim">Sim</option>
              <option value="Não">Não</option>
            </select>
          </div>
          <div>
            <label for="parteRelacionadaDoc" style="font-weight:600;">Existe Parte Relacionada?</label><br>
            <select id="parteRelacionadaDoc" name="parteRelacionadaDoc" style="width:100%;padding:8px 10px;border-radius:8px;border:1.5px solid #e7e7e7;font-size:1rem;">
              <option value="">Selecione</option>
              <option value="Sim">Sim</option>
              <option value="Não">Não</option>
            </select>
          </div>
            <label for="tipoUnidade" style="font-weight:600;">Tipo de Unidade</label><br>
            <select id="tipoUnidade" name="tipoUnidade" style="width:100%;padding:8px 10px;border-radius:8px;border:1.5px solid #e7e7e7;font-size:1rem;">
              <option value="">Selecione</option>
              <option value="Rede Varejo">Rede Varejo</option>
              <option value="Demais unidades">Demais unidades</option>
            </select>
          </div>
          <div class="wizard-form-row">
            <div>
              <label for="editalId" style="font-weight:600;">Identificação do Edital</label><br>
              <input type="text" id="editalId" name="editalId" placeholder="Ex: 123/2025" style="padding:8px 10px;border-radius:8px;border:1.5px solid #e7e7e7;font-size:1rem;">
            </div>
            <div>
              <label for="repCaixa" style="font-weight:600;">Representante CAIXA</label><br>
              <input type="text" id="repCaixa" name="repCaixa" placeholder="Ex: 123456 - João Silva" style="padding:8px 10px;border-radius:8px;border:1.5px solid #e7e7e7;font-size:1rem;">
            </div>
          </div>
          <div class="wizard-form-row">
            <div>
              <label for="valorMin" style="font-weight:600;">Valor Mínimo Ofertado</label><br>
              <input type="text" id="valorMin" name="valorMin" placeholder="Ex: R$ 100.000,00" style="padding:8px 10px;border-radius:8px;border:1.5px solid #e7e7e7;font-size:1rem;">
            </div>
            <div>
              <label for="valorMax" style="font-weight:600;">Valor Máximo Ofertado</label><br>
              <input type="text" id="valorMax" name="valorMax" placeholder="Ex: R$ 200.000,00" style="padding:8px 10px;border-radius:8px;border:1.5px solid #e7e7e7;font-size:1rem;">
            </div>
          </div>
          <div style="display:flex;flex-direction:column;gap:12px;">
            <div>
              <label style="font-weight:600;"><i class="fas fa-upload" style="margin-right:6px;"></i> Edital/Minuta do Contrato/Termo de Cessão</label><br>
              <input type="file" id="uploadEdital" name="uploadEdital" style="margin-top:6px;">
              <div style="font-size:0.97rem;color:#b3b3b3;margin-top:2px;">Selecione um arquivo PDF ou DOCX</div>
            </div>
            <div>
              <label style="font-weight:600;"><i class="fas fa-upload" style="margin-right:6px;"></i> Análise do Edital/Minuta/Termo</label><br>
              <input type="file" id="uploadAnalise" name="uploadAnalise" style="margin-top:6px;">
              <div style="font-size:0.97rem;color:#b3b3b3;margin-top:2px;">Selecione um arquivo PDF ou DOCX</div>
            </div>
            <div>
              <label style="font-weight:600;"><i class="fas fa-upload" style="margin-right:6px;"></i> Comprovação de Status de Vencedora</label><br>
              <input type="file" id="uploadStatus" name="uploadStatus" style="margin-top:6px;">
              <div style="font-size:0.97rem;color:#b3b3b3;margin-top:2px;">Selecione um arquivo PDF ou DOCX</div>
            </div>
          </div>
          <div style="display:flex;justify-content:space-between;margin-top:18px;gap:12px;">
            <button type="button" id="btnCancelWizard" style="background:#eee;color:#003366;font-weight:600;padding:10px 24px;border:none;border-radius:8px;font-size:1.08rem;cursor:pointer;">Cancelar</button>
            <button type="button" id="btnNextStep" style="background:#F39200;color:#003366;font-weight:700;padding:10px 28px;border:none;border-radius:8px;font-size:1.08rem;cursor:pointer;">Avançar</button>
          </div>
        </form>
      ` },
      { label: 'Documentação', icon: '<i class="fas fa-file-alt"></i>', content: `
        <form id="docForm" style="display:flex;flex-direction:column;gap:18px;">
          <div>
            <label for="tipoUnidadeDoc" style="font-weight:600;">Tipo de unidade</label><br>
            <select id="tipoUnidadeDoc" name="tipoUnidadeDoc" style="width:100%;padding:8px 10px;border-radius:8px;border:1.5px solid #e7e7e7;font-size:1rem;">
              <option value="">Selecione</option>
              <option value="Varejo">Varejo</option>
              <option value="Demais unidades CAIXA">Demais unidades CAIXA</option>
            </select>
          </div>
          <div>
            <label for="nomeUnidadeDoc" style="font-weight:600;">Nome da unidade</label><br>
            <input type="text" id="nomeUnidadeDoc" name="nomeUnidadeDoc" placeholder="Digite o nome da unidade..." style="width:100%;padding:8px 10px;border-radius:8px;border:1.5px solid #e7e7e7;font-size:1rem;">
          </div>
          <div>
            <label for="tipoNecessidadeDoc" style="font-weight:600;">Tipo de necessidade</label><br>
            <input type="text" id="tipoNecessidadeDoc" name="tipoNecessidadeDoc" value="Nova unidade" readonly style="width:100%;padding:8px 10px;border-radius:8px;border:1.5px solid #e7e7e7;font-size:1rem;background:#f5f5f5;color:#888;">
          </div>
          <div>
            <label for="reformaDoc" style="font-weight:600;">Necessita reforma ou ampliação?</label><br>
            <select id="reformaDoc" name="reformaDoc" style="width:100%;padding:8px 10px;border-radius:8px;border:1.5px solid #e7e7e7;font-size:1rem;">
              <option value="">Selecione</option>
              <option value="Sim">Sim</option>
              <option value="Não">Não</option>
            </select>
          </div>
          <div>
            <label for="tipoLocadorDoc" style="font-weight:600;">Tipo de Locador</label><br>
            <input type="text" id="tipoLocadorDoc" name="tipoLocadorDoc" value="Pessoa Jurídica" readonly style="width:100%;padding:8px 10px;border-radius:8px;border:1.5px solid #e7e7e7;font-size:1rem;background:#f5f5f5;color:#888;">
          </div>
          <div>
            <label for="terceirosDoc" style="font-weight:600;">Há terceiros beneficiários?</label><br>
            <select id="terceirosDoc" name="terceirosDoc" style="width:100%;padding:8px 10px;border-radius:8px;border:1.5px solid #e7e7e7;font-size:1rem;">
              <option value="">Selecione</option>
              <option value="Sim">Sim</option>
              <option value="Não">Não</option>
            </select>
          </div>
          <div>
            <label for="parteRelacionadaDoc" style="font-weight:600;">Existe Parte Relacionada?</label><br>
            <select id="parteRelacionadaDoc" name="parteRelacionadaDoc" style="width:100%;padding:8px 10px;border-radius:8px;border:1.5px solid #e7e7e7;font-size:1rem;">
              <option value="">Selecione</option>
              <option value="Sim">Sim</option>
              <option value="Não">Não</option>
            </select>
          </div>
          <div id="documentosChecklist" style="margin-top:24px;"></div>
          <div style="display:flex;justify-content:space-between;margin-top:18px;gap:12px;">
            <button type="button" id="btnPrevStepDoc" style="background:#eee;color:#003366;font-weight:600;padding:10px 24px;border:none;border-radius:8px;font-size:1.08rem;cursor:pointer;">Voltar</button>
            <button type="button" id="btnNextStepDoc" style="background:#F39200;color:#003366;font-weight:700;padding:10px 28px;border:none;border-radius:8px;font-size:1.08rem;cursor:pointer;">Avançar</button>
          </div>
        </form>
      ` },
      { label: 'Compliance', icon: '<i class="fas fa-shield-alt"></i>', content: `
        <form id="complianceForm" style="display:flex;flex-direction:column;gap:18px;">
          <div>
            <label for="historicoDecisoes" style="font-weight:600;">Histórico de decisões</label><br>
            <textarea id="historicoDecisoes" name="historicoDecisoes" rows="3" placeholder="Descreva o histórico de decisões..." style="width:100%;padding:8px 10px;border-radius:8px;border:1.5px solid #e7e7e7;font-size:1rem;"></textarea>
          </div>
          <div>
            <label for="autorizacoesAlcadas" style="font-weight:600;">Autorizações das alçadas competentes</label><br>
            <input type="text" id="autorizacoesAlcadas" name="autorizacoesAlcadas" placeholder="Informe as autorizações obtidas..." style="width:100%;padding:8px 10px;border-radius:8px;border:1.5px solid #e7e7e7;font-size:1rem;">
          </div>
          <div>
            <label for="conformidadeContratoEdital" style="font-weight:600;">Conformidade entre contrato e edital</label><br>
            <textarea id="conformidadeContratoEdital" name="conformidadeContratoEdital" rows="3" placeholder="Informe se foi verificada a conformidade entre contrato e edital..." style="width:100%;padding:8px 10px;border-radius:8px;border:1.5px solid #e7e7e7;font-size:1rem;"></textarea>
          </div>
          <div style="display:flex;justify-content:space-between;margin-top:18px;gap:12px;">
            <button type="button" id="btnPrevStepCompliance" style="background:#eee;color:#003366;font-weight:600;padding:10px 24px;border:none;border-radius:8px;font-size:1.08rem;cursor:pointer;">Voltar</button>
            <button type="button" id="btnNextStepCompliance" style="background:#F39200;color:#003366;font-weight:700;padding:10px 28px;border:none;border-radius:8px;font-size:1.08rem;cursor:pointer;">Avançar</button>
          </div>
        </form>
      ` },
      { label: 'Jurídico', icon: '<i class="fas fa-balance-scale"></i>', content: `
        <form id="juridicoRiscosForm" style="display:flex;flex-direction:column;gap:18px;">
          <div>
            <label for="historicoPedidos" style="font-weight:600;">Histórico de pedidos de esclarecimento e impugnações</label><br>
            <textarea id="historicoPedidos" name="historicoPedidos" rows="4" placeholder="Registre o histórico de pedidos de esclarecimento e impugnações realizados durante o certame..." style="width:100%;padding:8px 10px;border-radius:8px;border:1.5px solid #e7e7e7;font-size:1rem;"></textarea>
          </div>
          <div>
            <label style="font-weight:600;"><i class="fas fa-upload" style="margin-right:6px;"></i> Documento comprobatório (opcional)</label><br>
            <input type="file" id="uploadDocJuridico" name="uploadDocJuridico" style="margin-top:6px;">
            <div style="font-size:0.97rem;color:#b3b3b3;margin-top:2px;">Selecione um arquivo PDF ou DOCX, se necessário para transparência processual</div>
          </div>
          <div style="display:flex;justify-content:space-between;margin-top:18px;gap:12px;">
            <button type="button" id="btnPrevStepJuridico" style="background:#eee;color:#003366;font-weight:600;padding:10px 24px;border:none;border-radius:8px;font-size:1.08rem;cursor:pointer;">Voltar</button>
            <button type="button" id="btnNextStepJuridico" style="background:#F39200;color:#003366;font-weight:700;padding:10px 28px;border:none;border-radius:8px;font-size:1.08rem;cursor:pointer;">Avançar</button>
          </div>
        </form>
      ` },
      { label: 'Financeiro', icon: '<i class="fas fa-dollar-sign"></i>', content: `
        <form id="financeiroForm" style="display:flex;flex-direction:column;gap:18px;">
          <div>
            <label for="preComprometimento" style="font-weight:600;">Nº de pré-comprometimento financeiro no ERP/SAP</label><br>
            <input type="text" id="preComprometimento" name="preComprometimento" placeholder="Digite o número de pré-comprometimento..." style="width:100%;padding:8px 10px;border-radius:8px;border:1.5px solid #e7e7e7;font-size:1rem;">
          </div>
          <div>
            <label for="valorAdjudicado" style="font-weight:600;">Valor monetário adjudicado</label><br>
            <input type="text" id="valorAdjudicado" name="valorAdjudicado" placeholder="Ex: R$ 100.000,00" style="width:100%;padding:8px 10px;border-radius:8px;border:1.5px solid #e7e7e7;font-size:1rem;">
          </div>
          
          <!-- Seção de Dados Bancários integrada da Pessoa Física -->
          <div style="border-top: 2px solid #f0f0f0; padding-top: 18px; margin-top: 12px;">
            <h4 style="margin-bottom: 16px; color: #003366; display: flex; align-items: center;">
              <i class="fas fa-university" style="margin-right: 8px;"></i>
              Dados de Pagamento
            </h4>
            
            <div style="margin-bottom: 16px;">
              <label for="formaPagamentoJuridica" style="font-weight:600;">Forma de Pagamento</label><br>
              <select id="formaPagamentoJuridica" name="formaPagamentoJuridica" style="width:100%;padding:8px 10px;border-radius:8px;border:1.5px solid #e7e7e7;font-size:1rem;">
                <option value="">Selecione a forma de pagamento</option>
                <option value="deposito">Depósito em Conta</option>
                <option value="pix">PIX</option>
                <option value="ted">TED</option>
                <option value="doc">DOC</option>
              </select>
            </div>

            <div id="dadosBancariosJuridica" style="background: #f8f9fa; padding: 16px; border-radius: 8px; border: 1px solid #e9ecef;">
              <h5 style="margin-bottom: 12px; color: #003366;">Dados Bancários do Locador</h5>
              
              <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 12px; margin-bottom: 12px;">
                <div>
                  <label style="font-weight: 500; font-size: 0.95rem; color: #495057;">Agência</label>
                  <input type="text" id="agenciaJuridica" name="agenciaJuridica" placeholder="Ex: 1234" style="width:100%;padding:6px 8px;border-radius:6px;border:1.5px solid #e7e7e7;font-size:0.95rem;margin-top:4px;">
                </div>
                <div>
                  <label style="font-weight: 500; font-size: 0.95rem; color: #495057;">Nome da Agência</label>
                  <input type="text" id="agenciaNomeJuridica" name="agenciaNomeJuridica" placeholder="Ex: Agência Centro" style="width:100%;padding:6px 8px;border-radius:6px;border:1.5px solid #e7e7e7;font-size:0.95rem;margin-top:4px;">
                </div>
              </div>
              
              <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 12px; margin-bottom: 12px;">
                <div>
                  <label style="font-weight: 500; font-size: 0.95rem; color: #495057;">Número da Conta</label>
                  <input type="text" id="contaJuridica" name="contaJuridica" placeholder="Ex: 56789-0" style="width:100%;padding:6px 8px;border-radius:6px;border:1.5px solid #e7e7e7;font-size:0.95rem;margin-top:4px;">
                </div>
                <div>
                  <label style="font-weight: 500; font-size: 0.95rem; color: #495057;">Tipo de Conta</label>
                  <select id="tipoContaJuridica" name="tipoContaJuridica" style="width:100%;padding:6px 8px;border-radius:6px;border:1.5px solid #e7e7e7;font-size:0.95rem;margin-top:4px;">
                    <option value="">Selecione</option>
                    <option value="corrente">Conta Corrente</option>
                    <option value="poupanca">Poupança</option>
                  </select>
                </div>
              </div>

              <div>
                <label style="font-weight: 500; font-size: 0.95rem; color: #495057;">CNPJ do Titular da Conta</label>
                <input type="text" id="cnpjTitularConta" name="cnpjTitularConta" placeholder="Ex: 12.345.678/0001-90" style="width:100%;padding:6px 8px;border-radius:6px;border:1.5px solid #e7e7e7;font-size:0.95rem;margin-top:4px;">
              </div>
            </div>

            <button type="button" id="adicionarLocadorJuridica" style="background:#28a745;color:white;font-weight:600;padding:8px 16px;border:none;border-radius:6px;font-size:0.95rem;cursor:pointer;margin-top:12px;display:flex;align-items:center;gap:6px;">
              <i class="fas fa-plus"></i> Adicionar Locador
            </button>
          </div>

          <!-- Resumo de Valores -->
          <div style="background: #e8f4fd; padding: 16px; border-radius: 8px; border-left: 4px solid #0066cc; margin-top: 12px;">
            <h5 style="margin-bottom: 12px; color: #003366; display: flex; align-items: center;">
              <i class="fas fa-calculator" style="margin-right: 8px;"></i>
              Resumo Financeiro
            </h5>
            <div id="resumoValoresJuridica">
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; font-size: 0.95rem;">
                <div><strong>Valor do Aluguel:</strong> <span id="valorAluguelResumo">R$ 0,00</span></div>
                <div><strong>Periodicidade:</strong> <span id="periodicidadeResumo">Mensal</span></div>
                <div><strong>Reajuste:</strong> <span id="reajusteResumo">Anual (IGPM)</span></div>
                <div><strong>Vencimento:</strong> <span id="vencimentoResumo">Todo dia 15</span></div>
              </div>
            </div>
          </div>
          
          <div>
            <label for="detalhesFinanceiros" style="font-weight:600;">Detalhes financeiros da proposta vencedora</label><br>
            <textarea id="detalhesFinanceiros" name="detalhesFinanceiros" rows="3" placeholder="Registre os detalhes financeiros da proposta vencedora..." style="width:100%;padding:8px 10px;border-radius:8px;border:1.5px solid #e7e7e7;font-size:1rem;"></textarea>
          </div>
          
          <div style="display:flex;justify-content:space-between;margin-top:18px;gap:12px;">
            <button type="button" id="btnPrevStepFinanceiro" style="background:#eee;color:#003366;font-weight:600;padding:10px 24px;border:none;border-radius:8px;font-size:1.08rem;cursor:pointer;">Voltar</button>
            <button type="button" id="btnNextStepFinanceiro" style="background:#F39200;color:#003366;font-weight:700;padding:10px 28px;border:none;border-radius:8px;font-size:1.08rem;cursor:pointer;">Avançar</button>
          </div>
        </form>
      ` },
      { label: 'Confirmação', icon: '<i class="fas fa-check"></i>', content: `
        <div style="text-align:center;padding:8px 0;">
          <div aria-live="polite" style="margin-bottom:18px;">
            <span style="display:inline-block;background:#28a745;border-radius:50%;padding:4px;box-shadow:0 2px 8px #c8e6c9;">
              <i class="fas fa-check-circle" style="color:#fff;font-size:2.5rem;"></i>
            </span>
          </div>
          <div style="font-size:1.35rem;font-weight:700;margin-bottom:10px;color:#003366;">Solicitação enviada com sucesso!</div>
          <div style="font-size:1.08rem;margin-bottom:18px;color:#003366;">Sua solicitação foi registrada e encaminhada ao responsável.<br>Você pode visualizar o comprovante abaixo.</div>
          <button type="button" id="btnComprovante" style="background:#fff;color:#003366;font-weight:700;padding:10px 26px;border:2px solid #003366;border-radius:8px;font-size:1.08rem;cursor:pointer;margin-bottom:22px;outline:none;" tabindex="0" aria-label="Visualizar comprovante da solicitação">Visualizar Comprovante</button>
          <div style="font-size:1.05rem;margin-bottom:24px;color:#fff;">O que deseja fazer agora?</div>
          <div style="display:flex;justify-content:center;gap:18px;">
            <button type="button" id="btnNovaSolicitacao" style="background:#F39200;color:#003366;font-weight:700;padding:12px 28px;border:none;border-radius:8px;font-size:1.08rem;cursor:pointer;outline:none;" tabindex="0" aria-label="Fazer nova solicitação (atalho Alt+N)">Fazer Nova Solicitação</button>
            <button type="button" id="btnEncerrar" style="background:#eee;color:#003366;font-weight:600;padding:12px 28px;border:none;border-radius:8px;font-size:1.08rem;cursor:pointer;outline:none;" tabindex="0" aria-label="Encerrar e voltar ao portal (atalho Alt+E)">Encerrar</button>
          </div>
        </div>
      ` }
    ];
    let currentStep = 0;
    function renderWizard() {
      // Steps
      const stepsDiv = document.getElementById('wizardSteps');
      stepsDiv.innerHTML = '';
      steps.forEach((step, idx) => {
        const stepDiv = document.createElement('div');
        stepDiv.className = 'wizard-step' + (idx === currentStep ? ' active' : idx < currentStep ? ' completed' : '');
        stepDiv.innerHTML = `<div class="wizard-icon">${step.icon}</div><div class="wizard-label">${step.label}</div>`;
        stepsDiv.appendChild(stepDiv);
      });
      // Content
      document.getElementById('wizardContent').innerHTML = steps[currentStep].content;
      // Botão avançar e cancelar para cada passo
      // Passo 1
      const btnNext = document.getElementById('btnNextStep');
      if (btnNext) {
        btnNext.onclick = function() {
          if (currentStep < steps.length - 1) {
            currentStep++;
            renderWizard();
          }
        };
      }
      const btnCancel = document.getElementById('btnCancelWizard');
      if (btnCancel) {
        btnCancel.onclick = function() {
          const overlay = window.parent ? window.parent.document.getElementById('wizard-modal-overlay') : document.getElementById('wizard-modal-overlay');
          if (overlay) {
            overlay.style.display = 'none';
            const inner = window.parent ? window.parent.document.getElementById('wizard-modal-inner') : document.getElementById('wizard-modal-inner');
            if (inner) inner.innerHTML = '';
          } else {
            window.parent && window.parent.postMessage({ action: 'closeWizardModal' }, '*');
          }
        };
      }
      // Passo 2 - Documentação
      if (currentStep === 1) {
        // Carregar checklist JSON e montar UI dinâmica
        let checklistData = null;
        fetch('assets/js/documentacao.json')
          .then(r => r.json())
          .then(json => {
            checklistData = json.documentacao;
            const tipoContratacao = document.getElementById('tipoContratacaoDoc');
            const tipoLocador = document.getElementById('tipoLocadorDoc');
            const terceiros = document.getElementById('terceirosDoc');
            const checklistDiv = document.getElementById('documentosChecklist');

            function renderChecklist() {
              if (!tipoContratacao.value || !tipoLocador.value || !terceiros.value) {
                checklistDiv.innerHTML = '<div style="color:#888;font-size:1.05rem;">Selecione todas as opções acima para exibir os documentos necessários.</div>';
                return;
              }
              // Filtragem condicional
              const docsFiltrados = checklistData.map(cat => {
                // Filtra documentos por "aplica" e contexto
                const docs = (cat.documentos || []).filter(doc => {
                  // Aplica por tipo de contratação
                  if (doc.aplica && Array.isArray(doc.aplica)) {
                    if (doc.aplica.includes(tipoContratacao.value)) return true;
                    if (doc.aplica.includes(tipoLocador.value)) return true;
                    if (terceiros.value === 'Sim' && doc.aplica.includes('Quando houver terceiros beneficiários')) return true;
                    return false;
                  }
                  return true;
                });
                return { categoria: cat.categoria, documentos: docs };
              }).filter(cat => cat.documentos.length > 0);

              // Renderização agrupada por categoria
              checklistDiv.innerHTML = docsFiltrados.map(cat => `
                <div style='margin-bottom:18px;'>
                  <div style='font-weight:700;color:#003366;font-size:1.08rem;margin-bottom:6px;'>${cat.categoria}</div>
                  <ul style='margin:0 0 0 12px;padding:0;'>
                    ${cat.documentos.map(doc => `
                      <li style='margin-bottom:7px;'>
                        <label style='display:flex;align-items:center;gap:8px;'>
                          <input type='checkbox' data-doc-id='${doc.id}' ${doc.obrigatorio ? 'required' : ''} style='accent-color:#F39200;'>
                          <span style='font-weight:600;'>${doc.titulo}</span>
                          <span style='color:#888;font-size:0.97rem;'>${doc.descricao || ''}</span>
                          ${doc.obrigatorio ? `<span style='color:#c00;font-size:0.97rem;'>(obrigatório)</span>` : '<span style="color:#888;font-size:0.97rem;">(opcional)</span>'}
                        </label>
                        <div class="upload-container" id="upload-${doc.id}" style="display:none;margin-left:28px;margin-top:4px;">
                          <input type="file" name="file-${doc.id}" data-doc-id="${doc.id}" accept=".pdf,.doc,.docx,.jpg,.png">
                          <span class="upload-status" style="font-size:0.95rem;color:#888;margin-left:8px;"></span>
                        </div>
                      </li>
                    `).join('')}
                  </ul>
                </div>
              `).join('');
            // Exibir campo de upload ao marcar checkbox
            checklistDiv.querySelectorAll('input[type=checkbox][data-doc-id]').forEach(checkbox => {
              checkbox.addEventListener('change', function() {
                const uploadDiv = document.getElementById('upload-' + this.dataset.docId);
                if (this.checked) {
                  uploadDiv.style.display = 'block';
                } else {
                  uploadDiv.style.display = 'none';
                  uploadDiv.querySelector('input[type=file]').value = '';
                  uploadDiv.querySelector('.upload-status').textContent = '';
                }
              });
              // Se já estiver marcado (ex: ao reabrir), mostrar upload
              if (checkbox.checked) {
                document.getElementById('upload-' + checkbox.dataset.docId).style.display = 'block';
              }
            });

            // Handler de upload (simulação de status)
            checklistDiv.querySelectorAll('input[type=file][data-doc-id]').forEach(fileInput => {
              fileInput.addEventListener('change', function() {
                const file = this.files[0];
                if (!file) return;
                const statusSpan = this.nextElementSibling;
                statusSpan.textContent = 'Enviando...';
                // Simulação de envio
                setTimeout(() => {
                  statusSpan.textContent = 'Pendente de análise (' + new Date().toLocaleString('pt-BR') + ')';
                }, 1000);
              });
            });
            }

            tipoContratacao.addEventListener('change', renderChecklist);
            tipoLocador.addEventListener('change', renderChecklist);
            terceiros.addEventListener('change', renderChecklist);
            renderChecklist();
          });
      }
      const btnNextDoc = document.getElementById('btnNextStepDoc');
      if (btnNextDoc) {
        btnNextDoc.onclick = function() {
          // Validação automática dos obrigatórios
          if (currentStep === 1) {
            const checklistDiv = document.getElementById('documentosChecklist');
            const required = checklistDiv ? checklistDiv.querySelectorAll('input[required]') : [];
            let allChecked = true;
            required.forEach(inp => { if (!inp.checked) allChecked = false; });
            if (!allChecked) {
              alert('Por favor, marque todos os documentos obrigatórios antes de avançar.');
              return;
            }
          }
          if (currentStep < steps.length - 1) {
            currentStep++;
            renderWizard();
          }
        };
      }
      const btnPrevDoc = document.getElementById('btnPrevStepDoc');
      if (btnPrevDoc) {
        btnPrevDoc.onclick = function() {
          if (currentStep > 0) {
            currentStep--;
            renderWizard();
          }
        };
      }
      // Passo 3 - Compliance
      const btnNextCompliance = document.getElementById('btnNextStepCompliance');
      if (btnNextCompliance) {
        btnNextCompliance.onclick = function() {
          if (currentStep < steps.length - 1) {
            currentStep++;
            renderWizard();
          }
        };
      }
      const btnPrevCompliance = document.getElementById('btnPrevStepCompliance');
      if (btnPrevCompliance) {
        btnPrevCompliance.onclick = function() {
          if (currentStep > 0) {
            currentStep--;
            renderWizard();
          }
        };
      }
      // Passo 4 - Análise Jurídica e Riscos
      const btnNextJuridico = document.getElementById('btnNextStepJuridico');
      if (btnNextJuridico) {
        btnNextJuridico.onclick = function() {
          if (currentStep < steps.length - 1) {
            currentStep++;
            renderWizard();
          }
        };
      }
      const btnPrevJuridico = document.getElementById('btnPrevStepJuridico');
      if (btnPrevJuridico) {
        btnPrevJuridico.onclick = function() {
          if (currentStep > 0) {
            currentStep--;
            renderWizard();
          }
        };
      }
      // Passo 5 - Financeiro
      const btnNextFinanceiro = document.getElementById('btnNextStepFinanceiro');
      if (btnNextFinanceiro) {
        btnNextFinanceiro.onclick = function() {
          if (currentStep < steps.length - 1) {
            currentStep++;
            renderWizard();
          }
        };
      }
      const btnPrevFinanceiro = document.getElementById('btnPrevStepFinanceiro');
      if (btnPrevFinanceiro) {
        btnPrevFinanceiro.onclick = function() {
          if (currentStep > 0) {
            currentStep--;
            renderWizard();
          }
        };
      }

      // Funcionalidades específicas do step Financeiro
      const formaPagamentoSelect = document.getElementById('formaPagamentoJuridica');
      const dadosBancariosDiv = document.getElementById('dadosBancariosJuridica');
      const adicionarLocadorBtn = document.getElementById('adicionarLocadorJuridica');
      const valorAdjudicadoInput = document.getElementById('valorAdjudicado');

      // Mostrar/esconder dados bancários baseado na forma de pagamento
      if (formaPagamentoSelect && dadosBancariosDiv) {
        formaPagamentoSelect.onchange = function() {
          if (this.value && this.value !== '') {
            dadosBancariosDiv.style.display = 'block';
          } else {
            dadosBancariosDiv.style.display = 'none';
          }
        };
      }

      // Formatação CNPJ
      const cnpjInput = document.getElementById('cnpjTitularConta');
      if (cnpjInput) {
        cnpjInput.oninput = function() {
          let value = this.value.replace(/\D/g, '');
          value = value.replace(/^(\d{2})(\d)/, '$1.$2');
          value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
          value = value.replace(/\.(\d{3})(\d)/, '.$1/$2');
          value = value.replace(/(\d{4})(\d)/, '$1-$2');
          this.value = value;
        };
      }

      // Formatação do valor adjudicado
      if (valorAdjudicadoInput) {
        valorAdjudicadoInput.oninput = function() {
          let value = this.value.replace(/\D/g, '');
          value = (value / 100).toFixed(2);
          value = value.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
          value = value.replace('.', ',');
          this.value = 'R$ ' + value;
          
          // Atualiza o resumo
          const resumoValor = document.getElementById('valorAluguelResumo');
          if (resumoValor) {
            resumoValor.textContent = this.value || 'R$ 0,00';
          }
        };
      }

      // Funcionalidade de adicionar múltiplos locadores
      if (adicionarLocadorBtn) {
        let contadorLocadores = 1;
        
        adicionarLocadorBtn.onclick = function() {
          contadorLocadores++;
          const novoLocador = document.createElement('div');
          novoLocador.style.cssText = 'background: #f8f9fa; padding: 16px; border-radius: 8px; border: 1px solid #e9ecef; margin-top: 12px;';
          novoLocador.innerHTML = `
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
              <h5 style="margin: 0; color: #003366;">Locador ${contadorLocadores}</h5>
              <button type="button" class="remover-locador" style="background: #dc3545; color: white; border: none; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 0.8rem;">
                <i class="fas fa-trash"></i>
              </button>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 12px; margin-bottom: 12px;">
              <div>
                <label style="font-weight: 500; font-size: 0.95rem; color: #495057;">Agência</label>
                <input type="text" placeholder="Ex: 1234" style="width:100%;padding:6px 8px;border-radius:6px;border:1.5px solid #e7e7e7;font-size:0.95rem;margin-top:4px;">
              </div>
              <div>
                <label style="font-weight: 500; font-size: 0.95rem; color: #495057;">Nome da Agência</label>
                <input type="text" placeholder="Ex: Agência Centro" style="width:100%;padding:6px 8px;border-radius:6px;border:1.5px solid #e7e7e7;font-size:0.95rem;margin-top:4px;">
              </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 12px; margin-bottom: 12px;">
              <div>
                <label style="font-weight: 500; font-size: 0.95rem; color: #495057;">Número da Conta</label>
                <input type="text" placeholder="Ex: 56789-0" style="width:100%;padding:6px 8px;border-radius:6px;border:1.5px solid #e7e7e7;font-size:0.95rem;margin-top:4px;">
              </div>
              <div>
                <label style="font-weight: 500; font-size: 0.95rem; color: #495057;">Tipo de Conta</label>
                <select style="width:100%;padding:6px 8px;border-radius:6px;border:1.5px solid #e7e7e7;font-size:0.95rem;margin-top:4px;">
                  <option value="">Selecione</option>
                  <option value="corrente">Conta Corrente</option>
                  <option value="poupanca">Poupança</option>
                </select>
              </div>
            </div>

            <div>
              <label style="font-weight: 500; font-size: 0.95rem; color: #495057;">CNPJ do Titular da Conta</label>
              <input type="text" placeholder="Ex: 12.345.678/0001-90" class="cnpj-input" style="width:100%;padding:6px 8px;border-radius:6px;border:1.5px solid #e7e7e7;font-size:0.95rem;margin-top:4px;">
            </div>
          `;
          
          dadosBancariosDiv.appendChild(novoLocador);
          
          // Adiciona funcionalidade de remoção
          const btnRemover = novoLocador.querySelector('.remover-locador');
          btnRemover.onclick = function() {
            novoLocador.remove();
            // Reajusta numeração dos locadores
            const locadores = dadosBancariosDiv.querySelectorAll('h5');
            locadores.forEach((h5, index) => {
              if (index > 0) {
                h5.textContent = `Locador ${index + 1}`;
              }
            });
            contadorLocadores--;
          };
          
          // Adiciona formatação CNPJ ao novo campo
          const novoCnpjInput = novoLocador.querySelector('.cnpj-input');
          if (novoCnpjInput) {
            novoCnpjInput.oninput = function() {
              let value = this.value.replace(/\D/g, '');
              value = value.replace(/^(\d{2})(\d)/, '$1.$2');
              value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
              value = value.replace(/\.(\d{3})(\d)/, '.$1/$2');
              value = value.replace(/(\d{4})(\d)/, '$1-$2');
              this.value = value;
            };
          }
        };
      }
      // Passo 6 - Confirmação
      // Foco automático no botão comprovante para acessibilidade
      setTimeout(() => {
        const btnComprovante = document.getElementById('btnComprovante');
        if (btnComprovante) btnComprovante.focus();
      }, 100);

      // Visualização do comprovante (simulação)
      const btnComprovante = document.getElementById('btnComprovante');
      if (btnComprovante) {
        btnComprovante.onclick = function() {
          // Simulação de comprovante em modal
          // Cria overlay e modal separados para garantir clique no botão fechar
          const overlay = document.createElement('div');
          overlay.style.position = 'fixed';
          overlay.style.top = '0';
          overlay.style.left = '0';
          overlay.style.width = '100vw';
          overlay.style.height = '100vh';
          overlay.style.background = '#0007';
          overlay.style.zIndex = '9998';
          overlay.setAttribute('aria-hidden', 'true');

          const modal = document.createElement('div');
          modal.style.position = 'fixed';
          modal.style.top = '50%';
          modal.style.left = '50%';
          modal.style.transform = 'translate(-50%, -50%)';
          modal.style.background = '#fff';
          modal.style.borderRadius = '10px';
          modal.style.maxWidth = '420px';
          modal.style.width = '90vw';
          modal.style.padding = '32px 28px';
          modal.style.boxShadow = '0 2px 16px #0002';
          modal.style.textAlign = 'left';
          modal.style.zIndex = '9999';
          modal.tabIndex = 0;
          modal.innerHTML = `
            <div style='font-size:1.18rem;font-weight:700;color:#003366;margin-bottom:10px;text-align:center;'>Comprovante de Solicitação</div>
            <div style='font-size:1.01rem;color:#222;margin-bottom:8px;'><b>Protocolo:</b> #${Math.floor(Math.random()*900000+100000)}</div>
            <div style='font-size:0.98rem;color:#444;margin-bottom:0;'>Data: ${new Date().toLocaleDateString('pt-BR')}</div>
            <div style='font-size:0.98rem;color:#444;margin-bottom:18px;'>Hora: ${new Date().toLocaleTimeString('pt-BR')}</div>
            <div style='font-size:0.98rem;color:#444;margin-bottom:18px;text-align:center;'>Solicitação recebida e encaminhada ao responsável.</div>
            <div style='text-align:center;'>
              <button id='btnFecharComprovante' style='margin-top:10px;background:#F39200;color:#003366;font-weight:700;padding:8px 22px;border:none;border-radius:8px;font-size:1.05rem;cursor:pointer;'>Fechar</button>
            </div>
          `;
          document.body.appendChild(overlay);
          document.body.appendChild(modal);
          modal.focus();
          // Fechar ao clicar no botão
          document.getElementById('btnFecharComprovante').onclick = function() {
            modal.remove();
            overlay.remove();
          };
          // Fechar ao pressionar ESC
          modal.onkeydown = function(e) {
            if (e.key === 'Escape') {
              modal.remove();
              overlay.remove();
            }
          };
        };
      }
      // Atalhos de acessibilidade
      document.onkeydown = function(e) {
        if (e.altKey && e.key.toLowerCase() === 'n') {
          const btn = document.getElementById('btnNovaSolicitacao');
          if (btn) { btn.focus(); btn.click(); }
        }
        if (e.altKey && e.key.toLowerCase() === 'e') {
          const btn = document.getElementById('btnEncerrar');
          if (btn) { btn.focus(); btn.click(); }
        }
      };
      const btnNovaSolicitacao = document.getElementById('btnNovaSolicitacao');
      if (btnNovaSolicitacao) {
        btnNovaSolicitacao.onclick = function() {
          window.location.href = 'https://osvaldojeronymo.github.io/silic-request-service/';
        };
      }
      const btnEncerrar = document.getElementById('btnEncerrar');
      if (btnEncerrar) {
        btnEncerrar.onclick = function() {
          window.location.href = 'https://osvaldojeronymo.github.io/silic-portal-imoveis/';
        };
      }
    }
    renderWizard();
  </script>
</body>
</html>
